---
version: "3"

tasks:

  encrypt-secrets:
    desc: Generate a new cluster-secrets.yaml file using SOPS
    vars:
      CONFIG_DIR: "{{.CLUSTER_DIR}}/flux/configs/"
    cmds:
      - sops --encrypt "{{.CONFIG_DIR}}/cluster-secrets.dec.yaml" --output "{{.CONFIG_DIR}}/cluster-secrets.yaml" > /dev/null

  update-kubeconfig:
    desc: Update local copy of kubeconfig with file retrieved from cluster
    cmds:
      - cp "{{.ANSIBLE_DIR}}/kubeconfig.yaml" ~/.kube/config
      - cp "{{.ANSIBLE_DIR}}/kubeconfig.yaml" "{{.PROJECT_DIR}}/kubeconfig"
